# 视觉与定位传感器：摄像头、IMU、GNSS

这类传感器决定系统的语义理解能力与时空定位能力，是规划控制的上游基础。

---

## 1. 摄像头（Camera）

### 1.1 感光元件技术

| 参数 | CMOS | CCD |
| --- | --- | --- |
| 读出方式 | 每列独立 ADC，并行读出 | 逐行电荷转移 |
| 帧率 | 高（> 60 fps 容易实现）| 较低 |
| 功耗 | 低 | 高 |
| 集成度 | 高（ISP、DSP 可集成）| 低 |
| 车载主流 | ✓ | — |

**快门类型对比：**

| 快门类型 | 原理 | 适用场景 | 局限 |
| --- | --- | --- | --- |
| 卷帘快门（Rolling Shutter）| 逐行扫描，不同行采集时刻不同 | 静止/低速场景 | 运动中产生"果冻"畸变 |
| 全局快门（Global Shutter）| 所有像素同时曝光 | 高速运动 | 成本更高，噪声略大 |

!!! warning "快门选型"
    高速行驶时（> 80 km/h），卷帘快门导致的运动畸变可显著影响目标检测精度。L3+ 系统的关键前视摄像头建议选用全局快门。

### 1.2 分辨率与视场角

| 配置 | 分辨率 | FOV | 用途 |
| --- | --- | --- | --- |
| 前视长焦 | 8 MP（3840×2160）| 25–35° | 远距车辆/信号灯识别（100–200 m） |
| 前视标准 | 2–5 MP | 60–80° | 近场行人/障碍物 |
| 环视鱼眼 | 1–2 MP | 180–200° | 360° 近场，泊车拼接 |
| 车内 DMS | 1–2 MP | 宽角 | 驾驶员状态监测 |

### 1.3 HDR（高动态范围）技术

HDR 解决逆光、隧道口等高对比场景下的可用性问题：

**多曝光融合（Multi-Exposure HDR）：**

```
短曝光（高亮区细节）→ ┐
中曝光（正常亮度）  → ┤── 融合算法 → HDR 图像（12–15 bit）
长曝光（暗区细节）  → ┘
```

**动态范围（Dynamic Range）：**

$$DR = 20\log_{10}\frac{L_{\max}}{L_{\min}} \quad \text{(dB)}$$

汽车级 HDR 摄像头通常要求 > 120 dB（普通工业相机约 60–70 dB）。

### 1.4 关键性能指标

| 指标 | 说明 | 参考值 |
| --- | --- | --- |
| 动态范围 | 可同时表达的最亮/最暗比值 | > 120 dB（车规）|
| 帧率 | 每秒帧数 | 30–60 fps（常规）|
| 时延 | 光子到图像数据可用的时间 | < 30 ms |
| 感光度（ISO 等效）| 低照度表现 | 越高越好，需权衡噪声 |
| 镜头畸变 | 图像几何变形 | 需标定纠正 |
| 温度工作范围 | 车规 | -40°C ～ +85°C |

---

## 2. IMU（惯性测量单元）

### 2.1 MEMS 传感器原理

**加速度计（Accelerometer）：**

利用弹性悬挂质量块的挠曲量测量加速度：

$$F = m \cdot a \implies a = F / m$$

MEMS 加速度计通过电容差分测量质量块位移，转换为加速度。

**陀螺仪（Gyroscope）：**

MEMS 陀螺仪利用科里奥利效应（Coriolis Effect）测量角速度：

$$F_{\text{Coriolis}} = 2m\boldsymbol{\omega} \times \boldsymbol{v}$$

在旋转参考系中，振动质量块受科里奥利力驱动，振幅与角速度成正比。

### 2.2 IMU 误差模型

IMU 的误差主要来源：

| 误差类型 | 描述 | 建模 |
| --- | --- | --- |
| 零偏（Bias）| 静止时非零输出 | 常数 + 随机游走 |
| 噪声密度 | 白噪声（高频）| $\sigma_a$（mg/√Hz）、$\sigma_\omega$（°/h/√Hz）|
| 零偏稳定性 | 长时间内零偏的变化 | Allan 方差分析 |
| 标度因数误差 | 输出与真实值的增益偏差 | ppm 级 |
| 轴间耦合 | 相邻轴信号泄漏 | 标定矩阵修正 |

**IMU 积分漂移（误差传播）：**

$$\text{位置漂移} \approx \frac{1}{2} \sigma_a \cdot t^2 \quad \text{（加速度计零偏引起）}$$

以 $\sigma_a = 1 \text{ mg}$ 的 MEMS IMU 为例，10 秒后位置漂移约 50 cm，30 秒约 4.4 m。因此 IMU 必须与外部绝对定位（GNSS/地图）融合。

### 2.3 Allan 方差（稳定性分析）

Allan 方差是评估 IMU 噪声特性的标准方法，分析不同积分时间下的噪声特征：

```
log(Allan Deviation)
↑
│ 斜率 -1/2：角度/速度随机游走（白噪声）
│
│ 斜率 0 最低点：零偏稳定性
│
│ 斜率 +1/2：速率随机游走（1/f 噪声）
└────────────────────→ log(积分时间)
```

### 2.4 安装建议

- IMU 应安装在车体刚性结构上（底盘纵梁），避免弹性悬挂部件
- 安装位置应尽量靠近车辆几何中心（减少杠杆臂效应）
- 与主计算平台共振频率错开，减少振动耦合

---

## 3. GNSS（全球卫星定位系统）

### 3.1 系统概述

| 系统 | 运营方 | 频段 | 特点 |
| --- | --- | --- | --- |
| GPS | 美国（DoD）| L1/L2/L5 | 最成熟，覆盖最广 |
| BDS | 中国 | B1/B2/B3 | 中国境内增强 |
| GLONASS | 俄罗斯 | G1/G2 | FDMA 设计 |
| Galileo | 欧盟 | E1/E5/E6 | 开放、高精度 |

现代车载 GNSS 芯片通常同时接收 GPS + BDS + GLONASS（多系统多频），可用卫星数大幅增加，定位精度和可用性显著提升。

### 3.2 定位原理

GNSS 定位基于到至少 4 颗卫星的伪距测量，求解 $(x, y, z, \Delta t)$：

$$\rho_i = \sqrt{(x-x_i)^2 + (y-y_i)^2 + (z-z_i)^2} + c \cdot \Delta t + \epsilon_i$$

其中 $\rho_i$ 为伪距，$(x_i, y_i, z_i)$ 为卫星坐标，$\Delta t$ 为接收机时钟误差，$\epsilon_i$ 为误差项（大气延迟、多径等）。

### 3.3 RTK 差分定位原理

RTK（Real-Time Kinematic）通过基准站差分消除大部分误差：

```
基准站（已知精确坐标）
    │ 计算误差改正数（差分信息）
    ↓ 实时播发（4G/5G/V2X）
车端流动站
    │ 接收差分改正数
    │ 消除电离层/对流层/卫星钟差误差
    ↓
厘米级定位精度（水平 < 3 cm，垂直 < 5 cm）
```

**PPP-RTK（精密单点定位+RTK）：**

结合精密卫星轨道/钟差产品和区域改正数，无需传统基准站，覆盖范围更广：

- 精度：水平 5–10 cm（收敛后）
- 收敛时间：1–3 分钟（配合模糊度固定技术）

### 3.4 城市环境挑战

| 问题 | 原因 | 缓解措施 |
| --- | --- | --- |
| 多径效应 | 信号经建筑物反射到达接收机 | 多天线、高度角截止（> 15°）|
| 信号遮挡 | 高楼/高架/隧道遮挡天空 | 与 IMU/视觉融合 |
| 信号欺骗 | 伪造 GNSS 信号 | 与其他传感器一致性校验 |
| 城市峡谷 | 高楼密集区卫星可见性差 | 多星座接收，V2X 辅助 |

---

## 4. 定位融合建议

### 4.1 融合架构

```
GNSS（10–100 Hz，全局约束）
    │
    ↓ 紧耦合（误差状态 KF）
GNSS/IMU 融合（100–1000 Hz）
    │ 提供粗粒度全局位姿
    ↓
LiDAR/视觉地图匹配（10–20 Hz）
    │ 提供精确 3D 位置约束
    ↓
因子图全局优化（后端）
    │
    ↓ 高频内插（IMU 积分）
最终定位输出（50+ Hz，厘米级精度）
```

### 4.2 各传感器贡献

| 传感器 | 时间特性 | 空间特性 | 典型贡献 |
| --- | --- | --- | --- |
| IMU | 高频（1 kHz），短时精确 | 相对运动 | 高频位姿更新，短时漂移填补 |
| GNSS | 中频（10 Hz），长时稳定 | 全局绝对 | 消除 IMU 长程漂移 |
| LiDAR 地图匹配 | 中频（10 Hz），精确 | 局部相对 | 车道级精度，消除 GNSS 城市误差 |
| 视觉里程计 | 中频（30 Hz）| 相对 | 弱 GNSS 场景补充 |

### 4.3 GNSS 天线安装要求

- **安装位置**：车顶中央（最小遮挡角），远离金属支架（减少多径）
- **接地面**：需要足够大的接地面（Ground Plane），推荐直径 > 10 cm
- **电缆走线**：低损耗同轴电缆，避免靠近强 EMI 源（电机控制器、逆变器）
- **双天线配置**：安装两根天线可直接提供航向（Heading）初始化

---

## 5. 运维与数据闭环

### 5.1 关键监控指标

| 指标 | 说明 | 告警阈值 |
| --- | --- | --- |
| GNSS 卫星数 | 可用卫星数量 | < 6 颗告警 |
| PDOP | 位置精度衰减因子（越小越好）| > 3.0 告警 |
| IMU 温度 | 影响零偏稳定性 | 超出工作范围告警 |
| 定位跳变 | 相邻帧位置突变 | > 0.5 m/帧 告警 |
| 标定偏差 | 外参漂移量 | > 0.3° 或 1 cm 告警 |

### 5.2 数据闭环

- 记录每次标定版本与生效时间，支持按时段回溯
- 对"定位跳变""姿态抖动""GNSS 失效"事件自动触发片段上传
- 将典型失效工况回流训练集，持续优化融合策略和降级逻辑
