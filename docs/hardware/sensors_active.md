# 主动感知传感器：LiDAR、毫米波与超声波

主动传感器通过主动发射信号（光、电磁波或声波）获取目标信息，在低光照和动态测距场景下价值突出。

---

## 1. LiDAR（激光雷达）

### 1.1 工作原理

LiDAR 通过发射激光脉冲并测量回波时间计算距离：

$$d = \frac{c \cdot \Delta t}{2}$$

其中 $c$ 为光速（$3 \times 10^8$ m/s），$\Delta t$ 为发射到接收的时间差。

**测量方式：**

| 方式 | 原理 | 优势 |
| --- | --- | --- |
| ToF（飞行时间） | 直接测量脉冲往返时间 | 技术成熟，实现简单 |
| FMCW（调频连续波）| 测量频率差获得距离和速度 | 同时获取速度，抗干扰 |

### 1.2 技术路线对比

| 路线 | 扫描方式 | 优势 | 局限 |
| --- | --- | --- | --- |
| 机械旋转式 | 电机+棱镜旋转 | 360° FOV，点云均匀，技术成熟 | 体积大，可靠性受机械结构影响 |
| 混合固态（MEMS）| 微镜摆动 | 体积小，成本较低 | FOV 受限，点云密度不均 |
| 全固态（OPA/Flash）| 光学相控阵/面阵照射 | 无机械运动，可靠性高 | 技术成熟度低，量产一致性挑战 |
| FMCW 固态 | 调频扫描 | 速度测量，抗干扰，高精度 | 成本高，量产进度较慢 |

### 1.3 核心性能指标

| 指标 | 说明 | 典型值 |
| --- | --- | --- |
| 探测距离 | 最大可探测距离（10% 反射率目标） | 150–250 m |
| 角分辨率 | 水平/垂直角分辨率（越小越密） | H: 0.1°, V: 0.1–0.4° |
| 点频（Point Rate）| 每秒输出点数 | 100 万–1000 万点/秒 |
| 近距盲区 | 无法探测的最小距离 | 0.1–1 m |
| 抗雨雾能力 | 雨雪天气探测距离衰减 | 中等（优于视觉，弱于雷达）|

### 1.4 点云特性分析

```
点云在不同天气下的密度衰减（示例，100 m 目标）：

晴天（能见度 > 10 km）：保留 95%+ 点数
小雨（能见度 5–10 km）：保留 70–90% 点数
中雨（能见度 2–5 km）：保留 40–70% 点数
大雨/浓雾（能见度 < 500 m）：保留 10–30% 点数，严重退化
```

!!! warning "量产挑战"
    多辆车的 LiDAR 互相照射会导致串扰（Cross-talk），需要时序错开或使用 FMCW LiDAR（编码调制）来解决。

### 1.5 标定方法

**内参标定（出厂固定）：**
- 旋转中心偏差、各激光器安装角度误差
- 工厂环境使用精密夹具一次性标定

**外参标定（与车体坐标系）：**

靶板法：在已知位置放置角反射体，通过优化计算 LiDAR 到车体坐标系的变换矩阵 $T$：

$$T^* = \arg\min_T \sum_i \| T \cdot p_i^{\text{lidar}} - p_i^{\text{map}} \|^2$$

**在线外参监测：**
- 利用地面平面约束实时监控外参偏移
- 偏移超过阈值（如 0.5°）时触发重标定告警

---

## 2. 毫米波雷达（mmWave Radar）

### 2.1 工作原理（FMCW）

毫米波雷达通过发射频率线性调制的连续波（FMCW），利用发射波和回波的频率差同时获取目标的距离、速度和角度：

**距离测量（Range）：**

$$R = \frac{c \cdot f_{\text{beat}}}{2 \cdot S}$$

其中 $S$ 为调频斜率，$f_{\text{beat}}$ 为差拍频率（发射波与回波的频率差）。

**速度测量（Doppler）：**

$$v = \frac{\lambda \cdot f_d}{2}$$

其中 $\lambda$ 为波长，$f_d$ 为多普勒频移。这使雷达可以直接测量目标径向速度，无需依赖连续帧轨迹。

**角度测量：**

多天线（MIMO）通过相位差估计方位角，4D 成像雷达通过大天线阵列实现俯仰角估计。

### 2.2 常见分工

| 类型 | 频率 | 典型安装位 | 主要用途 |
| --- | --- | --- | --- |
| 长程雷达（LRR）| 77 GHz | 车头中央 | 高速前向跟踪，150–250 m |
| 短程/角雷达（SRR）| 77/79 GHz | 四角 | 并线辅助、盲区预警、近场 |
| 4D 成像雷达 | 77/79 GHz | 可替代 LRR | 高分辨率目标检测，含高度维 |

### 2.3 4D 成像雷达

传统 3D 雷达输出（Range, Velocity, Azimuth），4D 成像雷达额外增加**俯仰角（Elevation）**：

- 通过大天线阵列（虚拟天线数可达数百）实现更高角分辨率
- 点云密度接近稀疏 LiDAR，可用于目标分类
- 全天候能力优于 LiDAR，成本介于传统雷达和 LiDAR 之间

**主要厂商：** Continental HRS4、Arbe Phoenix、华为 4D 雷达、安智汽车

### 2.4 工程注意点

| 问题 | 描述 | 应对措施 |
| --- | --- | --- |
| 多径反射 | 信号经地面/障碍物反射产生虚假目标 | 高度过滤、聚类算法 |
| 目标关联 | 相邻帧同一目标匹配困难 | 基于速度的匹配算法 |
| 角度分辨率有限 | 近距离横向目标区分困难 | 与视觉融合提升分辨率 |
| 静止目标分类 | 难以区分路面杂波和真实障碍物 | 结合高度和反射特性滤波 |

---

## 3. 超声波传感器（Ultrasonic）

### 3.1 工作原理

超声波传感器发射 40–60 kHz 的超声脉冲，测量回波时间获得距离：

$$d = \frac{v_{\text{sound}} \cdot \Delta t}{2} \approx \frac{343 \text{ m/s} \times \Delta t}{2}$$

注意：声速受温度影响（$v = 331.4 + 0.607 \times T$（°C）），需要温度补偿。

### 3.2 特性与局限

| 特性 | 说明 |
| --- | --- |
| 有效测量范围 | 0.15–6 m（依频率和功率） |
| 角度覆盖（FOV）| 约 60–120°（锥形波束，纵向分辨率差）|
| 更新频率 | 10–25 Hz（声速限制） |
| 工作温度 | -40°C ～ +85°C |
| 对雨雪敏感度 | 中等（液态水会衰减，但比视觉强）|

!!! note "工程局限"
    超声波无法区分目标类型，无法测量速度，且在高速行驶时气流会影响精度。通常只用于 < 30 km/h 的低速泊车场景。

---

## 4. 传感器性能对比矩阵

| 维度 | LiDAR | 毫米波雷达 | 超声波 | 摄像头 |
| --- | --- | --- | --- | --- |
| 最大探测距离 | 150–250 m | 200–300 m | 6 m | 100–200 m |
| 距离精度 | ±2–5 cm | ±0.1–0.5 m | ±1–3 cm | 视算法 |
| 速度测量 | FMCW 可测 | 直接（多普勒）| 无 | 需连续帧 |
| 分类能力 | 中等（点云形状）| 弱 | 无 | 强（语义）|
| 夜间能力 | 完全不受影响 | 完全不受影响 | 完全不受影响 | 需补光 |
| 雨雾天气 | 中等退化 | 基本不退化 | 轻微退化 | 严重退化 |
| 量产成本 | 高（100–500 USD）| 低（10–50 USD）| 极低（1–5 USD）| 低（5–50 USD）|
| 功耗 | 中（5–30 W）| 低（1–5 W）| 极低（< 0.5 W）| 低（1–5 W）|

---

## 5. 传感器布局策略

典型 L4 Robotaxi 的 360° 覆盖方案：

```
                    ←前→
              ████████████
          ┌─────────────────┐
角雷达(LF)─┤  超声×4  超声×4 ├─角雷达(RF)
          │                 │
LiDAR主机─┤   车辆俯视图    ├─摄像头×4（前/后/左/右）
          │                 │
角雷达(LR)─┤  超声×4  超声×4 ├─角雷达(RR)
          └─────────────────┘
              ████████████
                    ←后→

补充：
  - 前视长焦摄像头（140 m+）
  - 前视广角摄像头（近场）
  - 车顶主 LiDAR（旋转，360° @ 200 m）
  - 可选：后视/侧向补充 LiDAR
```

---

## 6. 在线健康检查

每种传感器都应建立在线健康评估机制：

| 传感器 | 健康指标 | 告警触发条件 |
| --- | --- | --- |
| LiDAR | 点频、近场点数、返回功率 | 点频下降 > 20%；近场盲区异常增大 |
| 毫米波雷达 | 输出目标数量、噪声底 | 连续 3 帧无目标输出（非正常）|
| 超声波 | 回波信号强度、帧率 | 回波强度异常、连续丢帧 |

健康状态应实时上报给感知融合层，用于动态调整融合权重。

---

## 7. 选型与部署建议

1. **先定义 ODD，再确定传感器配置**：高速公路 vs 城区 vs 泊车场景对传感器需求差异极大
2. **制定清洁/加热策略**：LiDAR 镜面和摄像头玻璃须配备清洗液和加热膜，尤其对雪地、沙尘场景
3. **预留在线标定接口**：外参漂移是长期运营的大问题，应在架构阶段预留在线重标定能力
4. **建立多传感器互验机制**：LiDAR 目标与雷达目标的速度对比、摄像头检测框与 LiDAR 点云对比，及时发现单传感器异常
